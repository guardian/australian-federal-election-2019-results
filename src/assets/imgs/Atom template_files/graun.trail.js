webpackJsonp([6],{108:function(e,t,n){var o;void 0!==(o=function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.buildGoogleAnalyticsEvent=function(e,t,n,o,i,s){var a=o,r={eventCategory:"media",eventAction:i(e),eventLabel:n,dimension19:s,dimension20:a},u=t[e.eventType];return u&&(r[u]=1),r},e.getGoogleAnalyticsEventAction=function(e){var t=e.mediaType+" ";return e.isPreroll?t+="preroll":t+="content",t}}.apply(t,[t]))&&(e.exports=o)},198:function(e,t,n){var o,i;o=[t,n(106)],void 0!==(i=function(e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.isOn=e.saveState=void 0;var n=function(e){return e&&e.__esModule?e:{default:e}}(t),o=function(e){return!1!==n.default.get("accessibility."+e)};e.saveState=function(e){Object.keys(e).forEach(function(t){n.default.set("accessibility."+t,e[t])})},e.isOn=function(e){return!0===o(e)}}.apply(t,o))&&(e.exports=i)},199:function(e,t,n){var o,i;o=[t,n(28),n(196)],void 0!==(i=function(e,t,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.initYoutubePlayer=void 0;var o=function(e){return e&&e.__esModule?e:{default:e}}(t),i=new Promise(function(e){window.YT&&window.YT.Player?e():window.onYouTubeIframeAPIReady=e}),s=function(){(0,n.loadScript)("https://www.youtube.com/iframe_api",{})},a=function(e){e.classList.add("youtube__video-started")},r=function(e,t,n){o.default.write(function(){["ENDED","PLAYING","PAUSED","BUFFERING","CUED"].forEach(function(t){n.classList.toggle("youtube__video-"+t.toLocaleLowerCase(),e.data===window.YT.PlayerState[t])}),a(n)}),t&&"function"==typeof t.onPlayerStateChange&&t.onPlayerStateChange(e)},u=function(e,t,n){o.default.write(function(){n.classList.add("youtube__video-ready")}),t&&"function"==typeof t.onPlayerReady&&t.onPlayerReady(e)},d=function(e,t,n){return new window.YT.Player(e,{events:{onReady:t,onStateChange:n}})},l=function(e){return e.target.getCurrentTime()>0};e.initYoutubePlayer=function(e,t,n){return s(),i.then(function(){return d(n,function(n){l(n)&&a(e),u(n,t,e)},function(n){r(n,t,e)})})}}.apply(t,o))&&(e.exports=i)},200:function(e,t,n){var o,i;o=[t,n(7),n(0),n(35),n(108)],void 0!==(i=function(e,t,n,o,i){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.initYoutubeEvents=e.trackYoutubeEvent=void 0;var a=s(t),r=s(n),u=s(o),d=function(e,t){return e+":"+t};e.trackYoutubeEvent=function(e,t){a.default.emit(d(e,t),t)},e.initYoutubeEvents=function(e){var t=r.default.get("googleAnalytics.trackers.editorial"),n={metricMap:{play:"metric1",skip:"metric2",25:"metric3",50:"metric4",75:"metric5",end:"metric6"},baseEventObject:{eventCategory:"media",eventAction:"video content",eventLabel:e,dimension19:e,dimension20:"gu-video-youtube"}},o=function(e){var t={video:{id:"gu-video-youtube-"+e.mediaId,eventType:"video:content:"+e.eventType}};u.default.record(t)};["play","25","50","75","end"].forEach(function(s){a.default.once(d(s,e),function(a){var r={mediaId:e,mediaType:"video",eventType:s,isPreroll:!1};o(r),window.ga(t+".send","event",(0,i.buildGoogleAnalyticsEvent)(r,n.metricMap,a,"gu-video-youtube",function(){return"video content"},e))})})}}.apply(t,o))&&(e.exports=i)},202:function(e,t,n){var o,i;o=[t,n(28),n(199),n(200),n(33),n(41),n(0),n(22),n(29),n(198)],void 0!==(i=function(e,t,n,o,i,s,a,r,u,d){"use strict";function l(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.onVideoContainerNavigation=e.checkElemsForVideos=void 0;var c=l(t),m=l(s),f=l(a),h=l(u),p={},v=function(e){return e.split("/")[0]},g=function(e){var t=p[e].player,n=p[e].pendingTrackingCalls;if(n.length){t.duration||(t.duration=t.getDuration());var i=t.getCurrentTime();Math.round(i/t.duration*100)>=n[0]&&((0,o.trackYoutubeEvent)(n[0],v(e)),n.shift())}},y=function(e){p[e].progressTracker&&clearInterval(p[e].progressTracker)},b=function(e){return p[e].progressTracker=setInterval(g.bind(null,e),1e3),p[e].progressTracker},C={ENDED:function(e){var t=p[e];y(e),(0,o.trackYoutubeEvent)("end",v(e)),t.pendingTrackingCalls=[25,50,75];var n=t.iframe&&t.iframe.closest(".immersive-main-media")||null;n&&n.classList.remove("atom-playing")},PLAYING:function(e){var t=p[e];if(t){y(e),b(e),(0,o.trackYoutubeEvent)("play",v(e));var n=t.iframe&&t.iframe.closest(".immersive-main-media")||null,i=t.overlay&&t.overlay.parentNode,s=i&&i.querySelector(".end-slate-container");n&&n.classList.add("atom-playing"),t.endSlate&&!s&&t.endSlate.fetch(i,"html")}},PAUSED:function(e){return y(e)}},_=function(e,t,n){t===window.YT.PlayerState[n]&&C[n]&&C[n](e)},w=function(e){return"Video"===f.default.get("page.contentType")&&(f.default.get("page.isDev")?0===document.referrer.indexOf(window.location.origin):0===document.referrer.indexOf(f.default.get("page.host")))&&!((0,r.isIOS)()||(0,r.isAndroid)())&&(p[e].iframe&&p[e].iframe.closest('figure[data-component="main video"]')||!1)&&(0,d.isOn)("flashing-elements")},k=function(e){var t=e.parentNode;if(t instanceof HTMLElement){var n=(t.dataset||{}).endSlate;if(n){var o=new i.Component;return o.endpoint=n,o}}else;},T=function(){var e=document.querySelector(".immersive-main-media__media .youtube-media-atom"),t=e?e.offsetHeight:0,n=document.querySelector(".immersive-main-media__headline-container"),o=t-(n?n.offsetHeight:0),i=document.querySelector(".youtube-media-atom__immersive-interface");i&&(i.style.top=o+"px")},E=function(e,t,n,o){p[e]={player:o.target,pendingTrackingCalls:[25,50,75],iframe:n},w(e)&&o.target.playVideo(),t&&(p[e].overlay=t,f.default.page.section&&(0,r.isBreakpoint)({min:"desktop"})&&(p[e].endSlate=k(t))),n&&n.closest(".immersive-main-media__media")&&(T(),window.addEventListener("resize",(0,h.default)(T.bind(null),200)))},S=function(e,t){return Object.keys(C).forEach(_.bind(null,e,t.data))},P=function(e){e&&c.default.read(function(){(0,m.default)(".youtube-media-atom",e).each(function(e,t){var i=e.querySelector("iframe");if(i){i.id+="/"+t;var s=e.getAttribute("data-media-atom-id")+"/"+t;e.setAttribute("data-unique-atom-id",s);var a=e.querySelector(".youtube-media-atom__overlay");(0,o.initYoutubeEvents)(v(s)),(0,n.initYoutubePlayer)(i,{onPlayerReady:E.bind(null,s,a,i),onPlayerStateChange:S.bind(null,s)},i.id)}})})};e.checkElemsForVideos=function(e){e&&e.length?e.forEach(P):P(document.body)},e.onVideoContainerNavigation=function(e){var t=p[e];t&&t.player.pauseVideo()}}.apply(t,o))&&(e.exports=i)},363:function(e,t,n){var o,i;o=[t,n(111),n(0)],void 0!==(i=function(e,t,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.getUser=e.reportComment=e.unPickComment=e.pickComment=e.recommendComment=e.previewComment=e.postComment=e.send=void 0;var o=function(e){return e&&e.__esModule?e:{default:e}}(n),i=e.send=function(e,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(o.default.get("switches.enableDiscussionSwitch"))return(0,t.ajax)({url:o.default.get("page.discussionApiUrl")+e,type:"get"===n?"jsonp":"json",method:n,crossOrigin:!0,data:i,headers:{"D2-X-UID":o.default.get("page.discussionD2Uid"),"GU-Client":o.default.get("page.discussionApiClientHeader")},withCredentials:!0});throw new Error("Discussion features have been disabled")};e.postComment=function(e,t){var n="/discussion/"+e+"/comment"+(t.replyTo?"/"+t.replyTo.commentId+"/reply":"");return i(n,"post",t)},e.previewComment=function(e){return i("/comment/preview","post",e)},e.recommendComment=function(e){return i("/comment/"+e+"/recommend","post")},e.pickComment=function(e){return i("/comment/"+e+"/highlight","post")},e.unPickComment=function(e){return i("/comment/"+e+"/unhighlight","post")},e.reportComment=function(e,t){return i("/comment/"+e+"/reportAbuse","post",t)},e.getUser=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"me";return i("/profile/"+e,"get")}}.apply(t,o))&&(e.exports=i)},382:function(e,t,n){var o,i;o=[t,n(11),n(13),n(74),n(75),n(42),n(16),n(7),n(33),n(363),n(96),n(387),n(388),n(409)],void 0!==(i=function(e,t,n,o,i,s,a,r,u,d,l,c,m,f){"use strict";function h(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.CommentBox=void 0;var p=h(t),v=h(n),g=h(o),y=h(i),b=h(s),C=h(a),_=h(r),w=function(e){function t(e){(0,p.default)(this,t);var n=(0,g.default)(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n.useBem=!0,n.templateName="comment-box",n.componentClass="d-comment-box",n.classes={},n.errors=[],n.defaultOptions={discussionId:null,apiRoot:null,maxLength:5e3,premod:!1,newCommenter:!1,hasUsername:!0,focus:!1,state:"top-level",replyTo:null,priorToVerificationDate:new Date(1392719401337)},n.errorMessages={EMPTY_COMMENT_BODY:"Please write a comment.",COMMENT_TOO_LONG:"Your comment must be fewer than 5000 characters long.",USER_BANNED:'Commenting has been disabled for this account (<a href="/community-faqs#321a">why?</a>).',IP_THROTTLED:'Commenting has been temporarily blocked for this IP address (<a href="/community-faqs">why?</a>).',DISCUSSION_CLOSED:"Sorry your comment can not be published as the discussion is now closed for comments.",PARENT_COMMENT_MODERATED:"Sorry the comment can not be published as the comment you replied to has been moderated since.",COMMENT_RATE_LIMIT_EXCEEDED:"You can only post one comment every minute. Please try again in a moment.",INVALID_PROTOCOL:"Sorry your comment can not be published as it was not sent over a secure channel. Please report us this issue using the technical issue link in the page footer.",AUTH_COOKIE_INVALID:"Sorry, your comment was not published as you are no longer signed in. Please sign in and try again.","READ-ONLY-MODE":"Sorry your comment can not currently be published as commenting is undergoing maintenance but will be back shortly. Please try again in a moment.",API_CORS_BLOCKED:"Could not post due to your internet settings, which might be\n                 controlled by your provider. Please contact your administrator\n                 or disable any proxy servers or VPNs and try again.",API_ERROR:"Sorry, there was a problem posting your comment. Please try\n                another browser or network connection.  Reference code ",EMAIL_VERIFIED:'<span class="d-comment-box__error-meta">Sent. Please check your\n                email to verify your email address. Once verified post your\n                comment.</span>',EMAIL_VERIFIED_FAIL:'We are having technical difficulties. Please try again later or\n                <a href="/send/email" class="js-id-send-validation-email">\n                <strong>resend the verification</strong></a>.',EMAIL_NOT_VALIDATED:'Please confirm your email address to comment.<br />\n                If you can\'t find the email, we can\n                <a href="_#" class="js-id-send-validation-email">\n                <strong>resend the verification email</strong></a> to your email\n                address.'},n.setOptions(e),_.default.on("module:identity:validation-email:success",function(){return n.verificationEmailSuccess()}),_.default.on("module:identity:validation-email:fail",function(){return n.verificationEmailFail()}),n}return(0,y.default)(t,e),(0,v.default)(t,[{key:"onboardingPreviewSuccess",value:function(e,t){var n=this.getElem("onboarding-preview-body");n&&(n.innerHTML=t.commentBody)}},{key:"getDiscussionId",value:function(){var e=this.options.discussionId,t=this.elem&&this.elem instanceof HTMLElement&&this.elem.getAttribute("data-discussion-key");return!e&&t&&(t=t.replace("discussion","")),e||t||""}},{key:"setFormState",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.getElem("body"),n=this.getElem("submit");n&&(e||0===t.value.length)?n.setAttribute("disabled","disabled"):n&&n.removeAttribute("disabled")}},{key:"setExpanded",value:function(){this.setState("expanded")}},{key:"getUserData",value:function(){return(0,l.getUserFromCookie)()}},{key:"clearErrors",value:function(){var e=this.getElem("messages");e&&(e.innerHTML=""),this.errors=[],this.removeState("invalid")}},{key:"refreshUsernameHtml",value:function(){(0,l.reset)();var e=this.getUserData().displayName,t=document.querySelector(".js-profile-info"),n=document.querySelector("._author_tywwu_16");t&&e&&(t.innerHTML=e),n&&e&&(n.innerHTML=e)}},{key:"previewCommentSuccess",value:function(e,t){var n=this.getElem("preview-body");n&&(n.innerHTML=t.commentBody),this.setState("preview-visible")}},{key:"fail",value:function(e){var t=void 0;try{t=JSON.parse(e.responseText)}catch(e){t={}}this.setFormState(),0===e.status?this.error("API_CORS_BLOCKED"):"EMAIL_NOT_VALIDATED"===t.errorCode?this.invalidEmailError():"IP_ADDRESS_BLOCKED"===t.errorCode?this.error("IP_THROTTLED"):this.errorMessages[t.errorCode]?this.error(t.errorCode):this.error("API_ERROR",this.errorMessages.API_ERROR+e.status)}},{key:"postCommentSuccess",value:function(e,t){this.refreshUsernameHtml(),this.options.newCommenter&&(this.options.newCommenter=!1);var n=this.getElem("body");e.id=parseInt(t.message,10),n.value="",this.resetPreviewComment(),this.setFormState(),this.emit("post:success",e),_.default.emit("discussion:commentbox:post:success",e)}},{key:"error",value:function(e,t){var n=this.getElem("messages");this.setState("invalid");var o='\n            <div class="d-discussion__error '+this.getClass("error",!0)+'">\n                <i class="i i-alert"></i>\n                <span class="d-discussion__error-text">\n                    '+(t||this.errorMessages[e])+"\n                </span>\n            </div>";n&&n.appendChild(C.default.create(o)[0]),this.errors.push(e)}},{key:"postComment",value:function(){var e=this,t={body:(this.elem&&this.elem instanceof HTMLFormElement&&this.elem.body instanceof HTMLTextAreaElement&&this.elem.body||{}).value};this.clearErrors();var n=function(){e.removeState("onboarding-visible"),t.body=(0,f.urlify)(t.body),e.setFormState(!0),(0,d.postComment)(e.getDiscussionId(),t).then(function(n){return e.postCommentSuccess(t,n)}).catch(function(t){return e.fail(t)})},o=function(t){var o=e.getElem("onboarding-username");_.default.emit("user:username:updated",t.user.publicFields.username),e.options.hasUsername=!0,o&&o.classList.add("is-hidden"),n()},i=function(t){var n=e.getElem("onboarding-username-input"),o=e.getElem("onboarding-username-error-message");e.setState("onboarding-visible"),n&&n.classList.add("d-comment-box__onboarding-username-error-border"),o&&(o.innerHTML=JSON.parse(t.responseText).errors[0].description,o.classList.remove("is-hidden"))},s=function(){if(""===t.body&&e.error("EMPTY_COMMENT_BODY"),t.body.length>e.options.maxLength&&e.error("COMMENT_TOO_LONG","<b>Comments must be shorter than "+e.options.maxLength+" characters.</b>Yours is currently "+(t.body.length-e.options.maxLength)+" character(s) too long."),e.options.replyTo&&(t.replyTo=e.options.replyTo),0===e.errors.length)if(e.options.newCommenter&&!e.options.hasUsername){var s=e.getElem("onboarding-username-input");(0,l.updateUsername)(s.value).then(o,i)}else n()};this.getUserData().emailVerified?s():new Date(this.getUserData().accountCreatedDate)>this.options.priorToVerificationDate?(0,l.getUserFromApiWithRefreshedCookie)().then(function(t){!0===t.user.statusFields.userEmailValidated?s():e.invalidEmailError()}):s()}},{key:"invalidEmailError",value:function(){this.removeState("onboarding-visible"),this.error("EMAIL_NOT_VALIDATED"),(0,m.init)()}},{key:"submitPostComment",value:function(e){e.preventDefault(),this.postComment()}},{key:"ready",value:function(){var e=this;if(null===this.getDiscussionId())throw new Error('CommentBox: You need to set the "data-discussion-key" on your element');var t=this.getElem("body");if(this.setFormState(),this.options.newCommenter?(b.default.on(document.body,"submit",[this.elem],function(t){return e.showOnboarding(t)}),b.default.on(document.body,"click",this.getClass("onboarding-cancel"),function(t){return e.hideOnboarding(t)})):b.default.on(document.body,"submit",[this.elem],function(t){return e.submitPostComment(t)}),b.default.on(document.body,"change keyup",[t],function(){return e.setFormState()}),b.default.on(t,"focus",function(){return e.setExpanded()}),this.on("change",".d-comment-box__body",function(){return e.resetPreviewComment()}),this.on("click",this.getClass("preview"),function(){return e.previewComment("previewCommentSuccess")}),this.on("click",this.getClass("hide-preview"),function(){return e.resetPreviewComment()}),this.on("click",this.getClass("cancel"),function(){return e.cancelComment()}),this.on("click",this.getClass("show-parent"),function(){return e.setState("parent-visible")}),this.on("click",this.getClass("hide-parent"),function(){return e.removeState("parent-visible")}),["bold","italic","quote","link"].forEach(function(t){var n=e.getClass("formatting-"+t);e.on("click",n,function(){return e.formatComment(t)})}),this.options.state&&this.setState(this.options.state),this.options.focus){var n=this.getElem("body");n&&window.setTimeout(function(){n.focus()},0)}}},{key:"hideOnboarding",value:function(e){e.preventDefault(),this.removeState("onboarding-visible")}},{key:"showOnboarding",value:function(e){if(e.preventDefault(),this.hasState("onboarding-visible")||!this.options.newCommenter)this.options.hasUsername&&this.removeState("onboarding-visible"),this.postComment();else{var t=this.getElem("onboarding-author"),n=this.getElem("onboarding-username");t&&(t.innerHTML=this.getUserData().displayName),this.setState("onboarding-visible"),this.previewComment("onboardingPreviewSuccess"),n&&this.options.hasUsername&&n.classList.add("is-hidden")}}},{key:"prerender",value:function(){var e=this;if(!this.options.premod){var t=this.getElem("premod");t&&t.parentNode&&t.parentNode.removeChild(t)}var n=this.getUserData(),o=this.getElem("author");if(o&&(o.innerHTML=n.displayName),"response"===this.options.state){var i=this.getElem("submit");i&&(i.innerHTML="Post reply")}else if(this.options.shouldRenderMainAvatar){var s=this.getElem("avatar-wrapper");s&&(s.setAttribute("userid",n.id),s.setAttribute("data-userid",n.id),(0,c.avatarify)(s))}else{var a=document.getElementsByClassName("d-comment-box__meta")[0];a&&a.parentNode&&a.parentNode.removeChild(a)}if(this.options.replyTo){var r=this.getElem("reply-to-author"),u=this.getElem("parent-comment-body"),d=this.getElem("parent-comment-author"),l=this.options.replyTo||{},m=l.author,f=l.timestamp,h=l.body;r&&m&&(r.innerHTML=m),d&&m&&f&&(d.innerHTML=m+" @ "+f+" said:"),u&&h&&(u.innerHTML=h);var p=function(){var t=e.getElem("parent-comment-spout"),n=!!r&&r.offsetLeft+r.getBoundingClientRect().width/2;t&&n&&(t.style.marginLeft=n+"px")};window.setTimeout(function(){return p()},0)}}},{key:"verificationEmailSuccess",value:function(){this.clearErrors(),this.error("EMAIL_VERIFIED")}},{key:"verificationEmailFail",value:function(){this.clearErrors(),this.error("EMAIL_VERIFIED_FAIL")}},{key:"previewComment",value:function(e){var t=this,n={body:this.getElem("body").value},o=this[e].bind(this);if(this.clearErrors(),""===n.body&&(this.resetPreviewComment(),this.error("EMPTY_COMMENT_BODY")),n&&n.body&&n.body.length>this.options.maxLength){var i=n.body.length-this.options.maxLength,s="\n                <b>Comments must be shorter than\n                "+this.options.maxLength+" characters</b>. Yours is currently\n                "+i+" characters too long.";this.error("COMMENT_TOO_LONG",s)}0===this.errors.length&&(0,d.previewComment)(n).then(function(e){return o(n,e)}).catch(function(e){return t.fail(e)})}},{key:"cancelComment",value:function(){if("response"===this.options.state)this.destroy();else{var e=this.getElem("body");this.resetPreviewComment(),e.value="",this.setFormState(),this.removeState("expanded")}}},{key:"resetPreviewComment",value:function(){var e=this.getElem("preview-body");this.removeState("preview-visible"),e&&(e.innerHTML="")}},{key:"formatComment",value:function(e){var t=this.getElem("body"),n=t.selectionStart,o=t.value.substring(t.selectionStart,t.selectionEnd),i=function(e){t.setSelectionRange(n,n+e.length)},s=function(e,n){var s=e+o+n;t.value=t.value.substring(0,t.selectionStart)+s+t.value.substring(t.selectionEnd),i(s)};switch(e){case"bold":s("<b>","</b>");break;case"italic":s("<i>","</i>");break;case"quote":s("<blockquote>","</blockquote>");break;case"link":!function(){var e=void 0,n=void 0;/^https?:\/\//i.test(o)?e=o:(e=n=window.prompt("Your URL:","http://www."),o=o||n);var i='<a href="'+e+'">'+o+"</a>";t.value=t.value.substring(0,t.selectionStart)+i+t.value.substring(t.selectionEnd)}()}}}]),t}(u.Component);e.CommentBox=w}.apply(t,o))&&(e.exports=i)},383:function(e,t,n){var o,i;o=[e,t,n(111),n(0)],void 0!==(i=function(e,t,n,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){return e&&e.__esModule?e:{default:e}}(o),s=i.default.page.avatarApiUrl+"/v1",a=i.default.page.avatarImagesUrl+"/user",r=function(e,t,o){var i={url:s+t,type:"json",data:o,processData:!1,method:e,crossOrigin:!0,withCredentials:!0};return(0,n.ajax)(i)};t.default={request:r,getActive:function(){return r("GET","/avatars/user/me/active")},updateAvatar:function(e){return r("POST","/avatars",e)},deterministicUrl:function(e){return a+"/"+e}},e.exports=t.default}.apply(t,o))&&(e.exports=i)},385:function(e,t,n){var o,i;o=[t,n(16),n(29),n(72),n(7)],void 0!==(i=function(e,t,n,o,i){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.addProximityLoader=void 0;var a=s(t),r=s(n),u=s(o),d=s(i),l=[],c={top:0,bottom:0},m=function e(){c.top=window.pageYOffset,c.bottom=c.top+a.default.viewport().height,0===(l=l.filter(function(e){return!e.conditionFn()||(e.loadFn(),!1)})).length&&d.default.off("window:throttledScroll",e)},f=(0,r.default)(m,2e3),h=function(e,t){var n={conditionFn:e,loadFn:t};l.push(n),1===l.length&&d.default.on("window:throttledScroll",m),f()};e.addProximityLoader=function(e,t,n){u.default.read(function(){var o=(0,a.default)(e);h(function(){var e=o.offset(),n=e.top-t,i=e.top+e.height+t;return c.top>n&&c.bottom<i},n)})}}.apply(t,o))&&(e.exports=i)},386:function(e,t,n){var o,i;o=[t,n(49),n(72),n(34),n(41),n(0),n(195),n(385),n(449),n(407),n(96),n(414),n(450),n(451),n(453),n(454),n(457),n(458)],void 0!==(i=function(e,t,n,o,i,s,a,r,u,d,l,c,m,f,h,p,v,g){"use strict";function y(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.initTrails=void 0;var b=y(t),C=y(n),_=y(o),w=y(i),k=y(s),T=y(u),E=function(){var e=k.default.get("page",{}),t=e.showRelatedContent,n=e.isPaidContent,o=e.section,i=e.shortUrl,s=e.seriesId;if(k.default.get("isMedia")&&t&&!n&&o){var a=(0,w.default)(".js-more-in-section")[0];(0,g.moreInSeriesContainerInit)(a,k.default.get("page.contentType","").toLowerCase(),o,i,s)}},S=function(e,t){window.location.hash?t():C.default.read(function(){return document.querySelector(e)}).then(function(e){e&&(0,r.addProximityLoader)(e,1500,t)})},P=function(){k.default.get("page.isFront")||S(".js-popular-trails",function(){new m.MostPopular})},A=function(){k.default.get("page.seriesId")||k.default.get("page.blogIds")||S(".js-related",function(){var e={excludeTags:[]};"paid-content"!==k.default.get("page.sponsorshipType")&&e.excludeTags.push("tone/advertisement-features"),"contentType"in k.default.get("page")&&["video","interactive"].includes(k.default.page.contentType.toLowerCase())&&e.excludeTags.push("guardian-professional/guardian-professional"),(0,f.related)(e)})},x=function(){if(k.default.get("isMedia")){var e=k.default.get("page.contentType","").toLowerCase();(0,w.default)("video"===e?".js-video-components-container":".js-media-popular").each(function(t){(0,v.onwardVideo)(t,e)})}},M=function(){S(".js-onward",function(){(k.default.get("page.seriesId")||k.default.get("page.blogIds"))&&k.default.get("page.showRelatedContent")?new c.OnwardContent((0,_.default)(".js-onward")):""!==k.default.get("page.tones","")&&C.default.read(function(){return document.querySelectorAll(".js-onward")}).then(function(e){[].concat((0,b.default)(e)).forEach(function(e){(new h.TonalComponent).fetch(e,"html")})})}),x()},j=function(){k.default.get("switches.enableDiscussionSwitch")&&k.default.get("page.commentable")&&C.default.read(function(){return document.querySelector(".discussion")}).then(function(e){e&&(new d.Loader).attachTo(e)})},L=function(){(0,l.isUserLoggedIn)()||C.default.read(function(){return(0,w.default)(".js-comments")}).then(function(e){return C.default.write(function(){if(e.appendTo((0,_.default)(".js-repositioned-comments")),"#comments"===window.location.hash){var t=e.offset().top;(0,w.default)(document.body).scrollTop(t)}})})};e.initTrails=function(){(0,a.catchErrorsWithContext)([["c-discussion",j],["c-comments",L],["c-shares",p.loadShareCounts],["c-popular",P],["c-related",A],["c-onward",M],["c-comment-adverts",T.default],["c-more-in-section",E]])}}.apply(t,o))&&(e.exports=i)},387:function(e,t,n){var o,i;o=[t,n(49),n(383),n(16),n(0),n(72)],void 0!==(i=function(e,t,n,o,i,s){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.avatarify=e.initUserAvatars=void 0;var r=a(t),u=a(n),d=a(o),l=a(i),c=a(s),m=function(e){var t=(0,d.default)(d.default.create('<div class="is-updating"></div>')),n=(0,d.default)(d.default.create('<img class="user-avatar__image" alt="" />')),o=e.dataset.userid,i=l.default.get("user.id",null),s=function(t,n){t.remove(),n.appendTo(e)};e.classList.remove("is-hidden"),t.css("display","block").appendTo(e),o===i?u.default.getActive().then(function(e){n.attr("src",e.data.avatarUrl)}).catch(function(){var e=u.default.deterministicUrl(o);n.attr("src",e)}).always(function(){s(t,n)}):(n.attr("src",u.default.deterministicUrl(o)),s(t,n))};e.initUserAvatars=function(){return c.default.read(function(){return document.getElementsByClassName("user-avatar")}).then(function(e){e&&[].concat((0,r.default)(e)).forEach(m)})},e.avatarify=m}.apply(t,o))&&(e.exports=i)},388:function(e,t,n){var o,i;o=[t,n(72),n(7),n(96)],void 0!==(i=function(e,t,n,o){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.init=void 0;var s=i(t),a=i(n);e.init=function(){s.default.read(function(){return document.getElementsByClassName("js-id-send-validation-email")}).then(function(e){if(e.length){var t=e[0];t.addEventListener("click",function(e){e.preventDefault(),(0,o.isUserLoggedIn)()&&(0,o.sendValidationEmail)().then(function(e){if("error"===e.status)a.default.emit("module:identity:validation-email:fail"),s.default.write(function(){t.innerHTML="An error occured, please click here to try again."});else{a.default.emit("module:identity:validation-email:success");var n=t.parentNode;if(n){var o=document.createElement("p");o.innerText="Sent. Please check your email and follow the link.",s.default.write(function(){n.replaceChild(o,t)})}}},function(){a.default.emit("module:identity:validation-email:fail"),s.default.write(function(){t.innerHTML="An error occured, please click here to try again."})})})}})}}.apply(t,o))&&(e.exports=i)},396:function(e,t,n){var o;void 0!==(o=function(){var e=Math.ceil,t=Math.max;return function(n,o,i){n=+n||0,i="number"==typeof i?i:+i||1,null==o&&(o=n,n=0);for(var s=-1,a=t(0,e((o-n)/(i||1))),r=Array(a);++s<a;)r[s]=n,n+=i;return r}}.apply(t,[]))&&(e.exports=o)},407:function(e,t,n){var o,i;o=[t,n(11),n(13),n(74),n(75),n(42),n(16),n(34),n(41),n(36),n(0),n(22),n(7),n(203),n(72),n(23),n(408),n(367),n(33),n(363),n(382),n(410),n(412),n(413),n(96),n(106)],void 0!==(i=function(e,t,n,o,i,s,a,r,u,d,l,c,m,f,h,p,v,g,y,b,C,_,w,k,T,E){"use strict";function S(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.Loader=void 0;var P=S(t),A=S(n),x=S(o),M=S(i),j=S(s),L=S(a),O=S(r),I=S(u),D=S(d),R=S(l),U=S(m),H=S(h),F=S(p),N=S(E),B=function(e){function t(){(0,P.default)(this,t);var e=(0,x.default)(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.classes={},e.componentClass="discussion",e.comments=null,e.user=null,e.username=null,(0,g.begin)("discussion"),e}return(0,M.default)(t,e),(0,A.default)(t,[{key:"getUser",value:function(){var e=this;(0,T.getUserFromCookie)()?(0,b.getUser)().then(function(t){e.user=t.userProfile,(0,T.getUserFromApi)(function(t){t&&t.publicFields.username&&(e.username=t.publicFields.username),e.emit("user:loaded")})}):this.emit("user:loaded")}},{key:"getDiscussionId",value:function(){if(this.elem&&this.elem instanceof HTMLElement)return this.elem.getAttribute("data-discussion-key")}},{key:"getDiscussionClosed",value:function(){return!!(this.elem&&this.elem instanceof HTMLElement&&"true"===this.elem.getAttribute("data-discussion-closed"))}},{key:"getCommentIdFromHash",value:function(){var e=/#comment-(\d+)/;return e.exec(window.location.hash)?parseInt(e.exec(window.location.hash)[1],10):null}},{key:"setCommentHash",value:function(e){window.location.replace("#comment-"+e)}},{key:"commentPosted",value:function(e){this.removeState("truncated"),this.comments&&this.comments.addComment(e)}},{key:"initState",value:function(){this.getDiscussionClosed()?this.setState("closed"):this.comments&&this.comments.isReadOnly()?this.setState("readonly"):(0,T.getUserFromCookie)()&&this.user&&this.user.privateFields&&!this.user.privateFields.canPostComment?this.setState("banned"):this.setState("open")}},{key:"isCommentable",value:function(){var e=this.user&&this.user.privateFields&&this.user.privateFields.canPostComment,t=this.comments&&!this.comments.isReadOnly();return!(!e||!t||this.getDiscussionClosed())}},{key:"ready",value:function(){var e=this;this.$topCommentsContainer=(0,I.default)(".js-discussion-top-comments"),this.initTopComments(),this.initMainComments(),this.initToolbar(),this.renderCommentCount(),this.initPagination(),this.initRecommend(),(0,v.initDiscussionAnalytics)(),"#comments"===window.location.hash?U.default.emit("discussion:seen:comments-anchor"):this.getCommentIdFromHash()&&U.default.emit("discussion:seen:comment-permalink"),U.default.on("discussion:commentbox:post:success",function(){return e.removeState("empty")}),U.default.on("module:clickstream:click",function(t){t&&"hash"in t.target&&"#comments"===t.target.hash&&e.removeTruncation()}),(0,g.end)("discussion")}},{key:"initRecommend",value:function(){var e=this;this.on("click",".js-recommend-comment",function(t){var n=t.currentTarget;e.user&&e.elem instanceof HTMLElement&&(0,k.handle)(n,e.elem,e.user)}),this.on("click",".js-rec-tooltip-close",function(){(0,k.closeTooltip)()})}},{key:"initToolbar",value:function(){var e=this,t=(0,I.default)(".js-comment-order"),n=(0,I.default)(".js-comment-threading");if(n.text(this.comments&&this.comments.options.threading),t.text(this.comments&&this.comments.options.order),this.on("click",".js-comment-order-dropdown .popup__action",function(n){j.default.fire((0,O.default)(".js-comment-order-dropdown [data-toggle]")[0],"click"),e.comments&&(e.comments.options.order=(0,L.default)(n.currentTarget).data("order")),t.text(e.comments&&e.comments.options.order),N.default.set("discussion.order",e.comments&&e.comments.options.order),e.loadComments({page:1})}),this.on("click",".js-comment-threading-dropdown .popup__action",function(t){j.default.fire((0,O.default)(".js-comment-threading-dropdown [data-toggle]")[0],"click"),e.comments&&(e.comments.options.threading=(0,L.default)(t.currentTarget).data("threading")),n.text(e.comments&&e.comments.options.threading),N.default.set("discussion.threading",e.comments&&e.comments.options.threading),e.loadComments()}),"crosswords"===R.default.get("page.section")){var o=(0,I.default)(".js-timestamps"),i=function(e){o.text(e?"Relative":"Absolute")};i();var s=null===N.default.get("discussion.enableRelativeTimestamps")||N.default.get("discussion.enableRelativeTimestamps");i(s),this.on("click",".js-timestamps-dropdown .popup__action",function(t){var n=(0,L.default)(t.currentTarget).data("timestamp");j.default.fire((0,O.default)(".js-timestamps-dropdown [data-toggle]")[0],"click"),i("relative"===n),N.default.set("discussion.enableRelativeTimestamps","relative"===n),e.loadComments()})}}},{key:"initPageSizeDropdown",value:function(e){var t=this,n=(0,I.default)(".js-comment-pagesize");n.text(e),this.on("click",".js-comment-pagesize-dropdown .popup__action",function(e){var o=(0,L.default)(e.currentTarget).data("pagesize");j.default.fire((0,O.default)(".js-comment-pagesize-dropdown [data-toggle]")[0],"click"),t.comments&&(t.comments.options.pagesize=o),n.text(o),N.default.set("discussion.pagesize",o),t.loadComments({page:1})})}},{key:"initMainComments",value:function(){var e=this,t=this.getCommentIdFromHash(),n=N.default.get("discussion.order")||(this.getDiscussionClosed()?"oldest":"newest"),o=N.default.get("discussion.threading")||"collapsed",i=(0,c.isBreakpoint)({min:"tablet"})?25:10;this.comments=new _.Comments({discussionId:this.getDiscussionId(),order:n,pagesize:i,threading:o}),this.comments&&this.comments.attachTo((0,O.default)(".js-discussion-main-comments")[0]),this.comments&&this.comments.on("untruncate-thread",function(){return e.removeTruncation()}),this.on("click,",".js-discussion-author-link",function(){return e.removeTruncation()}),this.on("click",".js-discussion-change-page, .js-discussion-show-button",function(){U.default.emit("discussion:comments:get-more-replies"),e.removeTruncation()}),this.comments&&this.comments.on("rendered",function(t){var n=L.default.create(t),o=(0,O.default)(".js-discussion-toolbar",e.elem)[0],i=(0,I.default)(".js-discussion-pagination",o).empty();e.comments&&!e.comments.isAllPageSizeActive()&&i.html(n)}),this.setState("loading"),this.on("user:loaded",function(){if(e.initState(),e.renderCommentBar(),e.user){e.comments&&e.comments.addUser(e.user);var n=N.default.get("discussion.pagesize"),o=i;"number"==typeof n?o=n:"All"===n&&(o=R.default.get("switches.discussionAllPageSize")?"All":100),e.initPageSizeDropdown(o),e.comments&&R.default.get("switches.discussionPageSize")&&(0,c.isBreakpoint)({min:"tablet"})&&(e.comments.options.pagesize=o),e.user&&e.user.isStaff&&(e.removeState("not-staff"),e.setState("is-staff"))}var s=!t&&"#comments"!==window.location.hash;e.loadComments({comment:t,shouldTruncate:s}).catch(function(){return e.logError("Comments")})}),this.getUser()}},{key:"initTopComments",value:function(){var e=this,t=this.getDiscussionId();return this.on("click",".js-jump-to-comment",function(t){t.preventDefault();var n=(0,L.default)(t.currentTarget).data("comment-id");e.gotoComment(n)}),t?(0,F.default)("/discussion/top-comments/"+t+".json?commentsClosed="+this.getDiscussionClosed().toString(),{mode:"cors"}).then(function(t){e.$topCommentsContainer.html(t.html),e.topCommentCount=(0,O.default)(".d-top-comment",e.$topCommentsContainer[0]).length,0!==e.topCommentCount&&((0,I.default)(".js-discussion-comment-box--bottom").removeClass("discussion__comment-box--bottom--hidden"),e.setState("has-top-comments"))}).catch(function(){return e.logError("Top comments")}):Promise.resolve()}},{key:"logError",value:function(e,t){var n=e+" failed to load: ";t&&t.message&&(n+=t.message),D.default.captureMessage(n,{tags:{contentType:"comments",discussionId:this.getDiscussionId()}})}},{key:"initPagination",value:function(){var e=this;this.on("click",".js-discussion-change-page",function(t){var n=t.currentTarget,o=parseInt(n.getAttribute("data-page"),10);t.preventDefault(),e.setState("loading"),e.gotoPage(o)})}},{key:"gotoComment",value:function(e,t){var n=this;(0,I.default)("#comment-"+e,this.elem).length>0?"none"===(0,I.default)(".js-discussion-main-comments").css("display")?H.default.write(function(){n.comments&&n.comments.showHiddenComments(),n.removeState("truncated"),(0,I.default)(".d-discussion__show-all-comments").addClass("u-h")}).then(function(){n.setCommentHash(e)}):this.setCommentHash(e):t?((0,f.scrollToElement)((0,O.default)(".js-discussion-toolbar"),100),H.default.write(function(){(0,I.default)(".js-discussion-main-comments").prepend('<div class="d-discussion__message d-discussion__message--error">The comment you requested could not be found.</div>')}),D.default.captureMessage("Comment doesn't exist in response",{level:"error",extra:{commentId:e}})):this.loadComments({comment:e})}},{key:"gotoPage",value:function(e){(0,f.scrollToElement)((0,O.default)(".js-discussion-toolbar"),100),this.comments&&this.comments.relativeDates(),this.loadComments({page:e})}},{key:"loadComments",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=Object.assign({},t);return this.setState("loading"),n.shouldTruncate&&this.comments&&this.comments.isAllPageSizeActive()&&(n.pageSize=10),n.commentsClosed=this.getDiscussionClosed(),this.comments?this.comments.fetchComments(n).then(function(){e.removeState("loading"),n.shouldTruncate?e.setState("truncated"):e.removeState("truncated"),e.comments&&e.comments.shouldShowPageSizeMessage()?e.setState("pagesize-msg-show"):e.removeState("pagesize-msg-show"),n.comment&&e.gotoComment(n.comment.toString(),!0)}):Promise.resolve()}},{key:"removeTruncation",value:function(){this.comments&&this.comments.isAllPageSizeActive()?this.loadComments():this.removeState("truncated")}},{key:"renderCommentBox",value:function(e){var t=this;new C.CommentBox({discussionId:this.getDiscussionId(),premod:this.user&&this.user.privateFields&&this.user.privateFields.isPremoderated,newCommenter:this.user&&this.user.privateFields&&!this.user.privateFields.hasCommented,hasUsername:null!==this.username,shouldRenderMainAvatar:!1}).render(e).on("post:success",function(e){return t.commentPosted(e)})}},{key:"renderCommentBar",value:function(){this.isCommentable()&&(this.renderCommentBox((0,O.default)(".js-discussion-comment-box--top")[0]),this.renderCommentBox((0,O.default)(".js-discussion-comment-box--bottom")[0]))}},{key:"renderCommentCount",value:function(){(0,w.loadDiscussionFrontend)(this,{apiHost:R.default.page.discussionApiUrl,avatarImagesHost:R.default.page.avatarImagesUrl,closed:this.getDiscussionClosed(),discussionId:this.getDiscussionId(),element:document.getElementsByClassName("js-discussion-external-frontend")[0],userFromCookie:!!(0,T.getUserFromCookie)(),profileUrl:R.default.page.idUrl,profileClientId:R.default.switches.registerWithPhone?"comments":"",Promise:Promise})}}]),t}(y.Component);e.Loader=B}.apply(t,o))&&(e.exports=i)},408:function(e,t,n){var o,i;o=[t,n(41),n(16),n(0),n(29),n(7)],void 0!==(i=function(e,t,n,o,i,s){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.initDiscussionAnalytics=void 0;var r=a(t),u=a(n),d=a(o),l=a(i),c=a(s),m=!1,f=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=d.default.get("googleAnalytics.trackers.editorial");window.ga(n+".send","event","element view","onpage item",e,Object.assign({nonInteraction:!0},t))},h=function(){m||(m=!0)},p=function(){m||(m=!0)},v=function(){m||(f("scroll to comments"),m=!0)},g=function(){var e=(0,r.default)("#comments").offset(),t=window.pageYOffset,n=u.default.viewport().height;return e.top-n/2<t&&e.top+e.height-n/3>t},y=function(){m||c.default.on("window:throttledScroll",(0,l.default)(function e(){!m&&g()&&(v(),c.default.off("window:throttledScroll",(0,l.default)(e,200)))},200))};e.initDiscussionAnalytics=function(){c.default.on("discussion:seen:comment-permalink",p),c.default.on("discussion:seen:comments-anchor",h),y()}}.apply(t,o))&&(e.exports=i)},409:function(e,t,n){var o;void 0!==(o=function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.urlify=function(e){var t=new RegExp("\\b((https?://|www.)\\S+)\\b(?![^<]*>|[^<>]*</)","g");return e.replace(t,function(e,t,n){return'<a href="'+("www."===n?"http://"+t:t)+'">'+t+"</a>"})}}.apply(t,[t]))&&(e.exports=o)},410:function(e,t,n){var o,i;o=[t,n(166),n(11),n(13),n(74),n(75),n(41),n(42),n(16),n(34),n(0),n(23),n(7),n(73),n(76),n(33),n(363),n(382),n(411),n(372),n(106),n(197)],void 0!==(i=function(e,t,n,o,i,s,a,r,u,d,l,c,m,f,h,p,v,g,y,b,C,_){"use strict";function w(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.Comments=void 0;var k=w(t),T=w(n),E=w(o),S=w(i),P=w(s),A=w(a),x=w(r),M=w(u),j=w(d),L=w(l),O=w(c),I=w(m),D=w(f),R=w(C),U=function(){return null===R.default.get("discussion.enableRelativeTimestamps")||R.default.get("discussion.enableRelativeTimestamps")},H=function(e){function t(e){(0,T.default)(this,t);var n=(0,S.default)(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n.componentClass="d-comments",n.comments=null,n.topLevelComments=null,n.user=null,n.classes={comments:"d-thread--top-level",topLevelComment:"d-comment--top-level",reply:"d-comment--response",showReplies:"d-show-more-replies",showRepliesButton:"d-show-more-replies__button",newComments:"js-new-comments",comment:"d-comment",commentReply:"d-comment__action--reply",commentPick:"d-comment__action--pick",commentStaff:"d-comment--staff",commentBody:"d-comment__body",commentTimestampJs:"js-timestamp",commentReport:"js-report-comment"},n.defaultOptions={discussionId:null,showRepliesCount:3,commentId:null,order:"newest",threading:"collapsed"},n.setOptions(e),n}return(0,P.default)(t,e),(0,E.default)(t,[{key:"getMoreReplies",value:function(e){var t=this;e.preventDefault();var n=e.target,o=e.currentTarget,i=o.closest(this.getClass("showReplies"));i&&(i.innerHTML="Loadingâ€¦");var s=(0,M.default)(n).data("source-comment"),a=o.getAttribute("data-comment-id");if(a){var r="/discussion/comment/"+a+".json?displayThreaded=true";(0,O.default)(r,{mode:"cors"}).then(function(e){var n=M.default.create(e.html),o=(0,j.default)(t.getClass("reply"),n).slice(t.options&&t.options.showRepliesCount);(0,M.default)((0,j.default)(".d-thread--responses",s)).append(o),(0,M.default)(i).addClass("u-h"),t.emit("untruncate-thread"),U()&&t.relativeDates()}).catch(function(e){(0,D.default)(e,{feature:"comments-more-replies"})})}}},{key:"addMoreRepliesButtons",value:function(e){var t=this;(e||this.topLevelComments).forEach(function(e){var n=parseInt(e.getAttribute("data-comment-replies"),10),o=(0,j.default)(t.getClass("reply"),e);if(o.length<n){var i=n-o.length,s='\n                    <button class="u-button-reset button button--show-more button--small button--tone-news d-show-more-replies__button">\n                        '+(0,_.inlineSvg)("plus",["icon"])+"Show "+i+" more "+(1===i?"reply":"replies")+"\n                    </button>",a=A.default.create(s).attr({"data-link-name":"Show more replies","data-is-ajax":"","data-comment-id":e.getAttribute("data-comment-id")}).data("source-comment",e);A.default.create('<li class="'+t.getClass("showReplies",!0)+'"></li>').append(a).appendTo((0,A.default)(".d-thread--responses",e))}})}},{key:"fetchComments",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=(this.options||{}).discussionId,o="/discussion/"+(t.comment?"comment-context/"+t.comment:n)+".json",i=t.order||this.options&&this.options.order,s=void 0,a={mode:"cors"};"recommendations"===i&&(i="mostRecommended");var r={orderBy:i,pageSize:t.pagesize||this.options&&this.options.pagesize,displayThreaded:!(!this.options||"unthreaded"===this.options.threading),commentsClosed:t.commentsClosed};return t.page&&(r.page=t.page),!t.comment&&this.options&&"collapsed"===this.options.threading&&(r.maxResponses=3),this.isAllPageSizeActive()?s=new y.WholeDiscussion({discussionId:this.options&&this.options.discussionId,orderBy:r.orderBy,displayThreaded:r.displayThreaded,maxResponses:r.maxResponses,commentsClosed:r.commentsClosed}).loadAllComments().catch(function(){return e.wholeDiscussionErrors=!0,r.pageSize=100,(0,O.default)(o+"?"+(0,h.constructQuery)(r),a)}):("All"===r.pageSize&&(r.pageSize=100),s=(0,O.default)(o+"?"+(0,h.constructQuery)(r),a)),s.then(function(t){return e.renderComments(t)})}},{key:"handlePickClick",value:function(e){e.preventDefault();var t=e.target,n=t.getAttribute("data-comment-id"),o=(0,A.default)(t),i="true"===o[0].getAttribute("data-comment-highlighted")?this.unPickComment:this.pickComment;n&&i.call(this,n,o).catch(function(e){var t=e.response.length>0?JSON.parse(e.response).message:e.statusText;o.text(t)})}},{key:"pickComment",value:function(e,t){var n=this,o=(0,j.default)("#comment-"+e,this.elem);return(0,v.pickComment)(e).then(function(){(0,A.default)(n.getClass("commentPick"),o).removeClass("u-h"),t.text("Unpick"),o.setAttribute("data-comment-highlighted",!0)})}},{key:"ready",value:function(){var e=this;this.topLevelComments=(0,j.default)(this.getClass("topLevelComment"),this.elem),this.comments=(0,j.default)(this.getClass("comment"),this.elem),this.on("click",this.getClass("showRepliesButton"),function(t){return e.getMoreReplies(t)}),this.on("click",this.getClass("commentReport"),function(t){return e.reportComment(t)}),U()&&(window.setInterval(function(){return e.relativeDates()},6e4),this.relativeDates()),this.emit("ready"),this.on("click",".js-report-comment-close",function(){var e=document.querySelector(".js-report-comment-form");e&&e.setAttribute("hidden","")})}},{key:"showHiddenComments",value:function(e){e&&e.preventDefault(),this.emit("first-load"),(0,A.default)(".js-discussion-main-comments").css("display","block"),U()&&this.relativeDates()}},{key:"unPickComment",value:function(e,t){var n=this,o=(0,j.default)("#comment-"+e);return(0,v.unPickComment)(e).then(function(){(0,A.default)(n.getClass("commentPick"),o).addClass("u-h"),t.text("Pick"),o.setAttribute("data-comment-highlighted",!1)})}},{key:"isReadOnly",value:function(){return!!(this.elem&&this.elem instanceof HTMLElement&&"true"===this.elem.getAttribute("data-read-only"))}},{key:"addComment",value:function(e,t){var n=M.default.create(this.postedCommentEl)[0],o=(0,M.default)(n),i=n&&n.getElementsByClassName(this.getClass("commentReply",!0))[0],s={username:"d-comment__author",timestamp:"js-timestamp",body:"d-comment__body",report:"d-comment__action--report",avatar:"d-comment__avatar"},a={username:this.user&&this.user.displayName,timestamp:"Just now",body:"<p>"+e.body.replace(/\n+/g,"</p><p>")+"</p>",report:{href:"http://discussion.theguardian.com/components/report-abuse/"+e.id},avatar:{src:this.user&&this.user.avatar}};o.addClass("d-comment--new"),Object.keys(s).forEach(function(e){var t=s[e],o=a[e],i=(0,j.default)("."+t,n)[0];"string"==typeof o?i.innerHTML=o:"object"===(void 0===o?"undefined":(0,k.default)(o))&&Object.keys(o).forEach(function(e){i.setAttribute(e,o[e])})}),n.id="comment-"+e.id,this.user&&!this.user.isStaff&&o.addClass(this.getClass("commentStaff",!0)),i&&i.setAttribute("data-comment-id",e.id),t?(o.removeClass(this.getClass("topLevelComment",!0)),o.addClass(this.getClass("reply",!0)),(0,M.default)(t).append(o)):(0,A.default)(this.getClass("newComments"),this.elem).prepend(n),window.location.replace("#comment-"+e.id)}},{key:"replyToComment",value:function(e){var t=this;e.preventDefault();var n=e.currentTarget.getAttribute("data-comment-id");if(n){var o=document.getElementById("reply-to-"+n);if(o)o.focus();else{(0,A.default)(".d-comment-box--response").remove();var i=(0,j.default)("#comment-"+n)[0],s=i.getAttribute("data-comment-author"),a=i.getAttribute("data-comment-author-id"),r=(0,M.default)(i),u=(0,j.default)(this.getClass("commentBody"),i)[0].innerHTML,d=(0,j.default)(this.getClass("commentTimestampJs"),i)[0].innerHTML,l=new g.CommentBox({discussionId:this.options&&this.options.discussionId,premod:this.user&&this.user.privateFields&&this.user.privateFields.isPremoderated,state:"response",replyTo:{commentId:n,author:s,authorId:a,body:u,timestamp:d},focus:!0}),c=r.hasClass(this.getClass("topLevelComment",!0))?r[0]:r.parent().parent()[0],m=(0,j.default)(this.getClass("showReplies"),c);m.length>0&&!(0,M.default)(m).hasClass("u-h")&&m[0].click(),l.render(c),l.on("post:success",function(e){var n=(0,j.default)(".d-thread--responses",c)[0];n||(n=M.default.create('<ul class="d-thread d-thread--responses"></ul>')[0],(0,M.default)(c).append(n)),l.destroy(),t.addComment(e,n)})}}}},{key:"reportComment",value:function(e){e.preventDefault();var t=e.currentTarget.getAttribute("data-comment-id");if(t){var n=document.querySelector("#comment-"+t+" .js-report-comment-container");(0,A.default)(".js-report-comment-form").first().each(function(e){e.removeAttribute("hidden"),x.default.one(e,"submit",function(n){n.preventDefault();var o=e.querySelector('[name="category"]'),i=e.querySelector('[name="comment"]'),s=function(e){e.setAttribute("hidden","")},a=function(){var e=document.querySelector(".d-report-comment__close"),t=document.querySelector(".js-discussion__report-comment-error");t&&t.removeAttribute("hidden"),e&&e.classList.add("d-report-comment__close--error")};if(t&&"0"!==o.value){var r=e.querySelector('[name="email"]');(0,v.reportComment)(t,{emailAddress:r.value,categoryId:o.value,reason:i.value}).then(function(){return s(e)}).catch(function(){return a()})}})}).appendTo(n)}}},{key:"addUser",value:function(e){var t=this;this.user=e,this.user&&this.user.badge&&(this.user.isStaff=this.user.badge.some(function(e){return"Staff"===e.name})),this.isReadOnly()||this.user&&this.user.privateFields.canPostComment&&((0,A.default)(this.getClass("commentReply")).attr("href","#"),this.on("click",this.getClass("commentReply"),function(e){return t.replyToComment(e)}),this.on("click",this.getClass("commentPick"),function(e){return t.handlePickClick(e)})),I.default.on("user:username:updated",function(e){t.user&&(t.user.displayName=e)})}},{key:"relativeDates",value:function(){U()&&(0,b.init)()}},{key:"isAllPageSizeActive",value:function(){return!(!L.default.get("switches.discussionAllPageSize")||!this.options||"All"!==this.options.pagesize||this.wholeDiscussionErrors)}},{key:"shouldShowPageSizeMessage",value:function(){return!!(L.default.get("switches.discussionAllPageSize")&&this.options&&"All"===this.options.pagesize&&this.wholeDiscussionErrors)}},{key:"renderComments",value:function(e){var t=M.default.create(e.commentsHtml),n=(0,j.default)(this.getClass("comment"),t);(0,M.default)(this.elem).empty().append(t),this.addMoreRepliesButtons(n),this.postedCommentEl=e.postedCommentHtml,U()&&this.relativeDates(),this.emit("rendered",e.paginationHtml),I.default.emit("modules:comments:renderComments:rendered")}}]),t}(p.Component);e.Comments=H}.apply(t,o))&&(e.exports=i)},411:function(e,t,n){var o,i;o=[t,n(11),n(13),n(41),n(16),n(23),n(76),n(396)],void 0!==(i=function(e,t,n,o,i,s,a,r){"use strict";function u(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.WholeDiscussion=void 0;var d=u(t),l=u(n),c=u(o),m=u(i),f=u(s),h=u(r),p=function(e,t){return new Promise(function(n){var o=t,i=0,s=function(){i-=1,o.length?a(o.shift()):i||n()},a=function(t){i+=1,e.call(null,t).then(s,s)};t&&t.length?t.splice(0,3).forEach(a):n()})},v=function(){function e(t){(0,d.default)(this,e),this.discussionId=t.discussionId,this.discussion=[],this.params={orderBy:t.orderBy,displayThreaded:t.displayThreaded,maxResponses:t.maxResponses,commentsClosed:t.commentsClosed}}return(0,l.default)(e,[{key:"firstPageLoaded",value:function(e){if(this.storeCommentPage(e,1),this.discussionContainer=m.default.create(e.commentsHtml),this.postedCommentHtml=e.postedCommentHtml,this.lastPage=e.lastPage,this.commentsThread=(0,c.default)(".d-thread--comments",this.discussionContainer).empty(),e.commentCount>1e3)throw new Error("Discussion comment count too large");return(0,h.default)(2,this.lastPage+1)}},{key:"storeCommentPage",value:function(e,t){var n=(0,c.default)(".d-thread--comments",m.default.create(e.commentsHtml)),o=(0,c.default)(".d-comment--top-level",n);"newest"===this.params.orderBy&&(o=o.map(function(e){return e}).reverse()),this.discussion[t]=o}},{key:"loadPage",value:function(e){var t={orderBy:"oldest",page:e,pageSize:50,displayThreaded:this.params.displayThreaded,commentsClosed:this.params.commentsClosed};this.params.maxResponses&&(t.maxResponses=this.params.maxResponses);var n="/discussion/"+this.discussionId+".json?"+(0,a.constructQuery)(t);return(0,f.default)(n,{mode:"cors"})}},{key:"loadPageAndStore",value:function(e){var t=this;return this.loadPage(e).then(function(n){t.storeCommentPage(n,e)})}},{key:"loadRemainingPages",value:function(e){return p(this.loadPageAndStore.bind(this),e)}},{key:"makeDiscussionResponseObject",value:function(){return"newest"===this.params.orderBy&&this.discussion.reverse(),this.discussion.reduce(function(e,t){return e.append(t),e},this.commentsThread),{paginationHtml:"",postedCommentHtml:this.postedCommentHtml,commentsHtml:this.discussionContainer.html(),lastPage:this.lastPage}}},{key:"loadAllComments",value:function(){var e=this;return this.loadPage(1).then(function(t){return e.firstPageLoaded(t)}).then(function(t){return e.loadRemainingPages(t)}).then(function(){return e.makeDiscussionResponseObject()})}}]),e}();e.WholeDiscussion=v}.apply(t,o))&&(e.exports=i)},412:function(e,t,n){var o,i;o=[t,n(49),n(0),n(28),n(395),n(196),n(7),n(73)],void 0!==(i=function(e,t,n,o,i,s,a,r){"use strict";function u(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.loadDiscussionFrontend=void 0;var d=u(t),l=u(n),c=u(o),m=u(a),f=u(r);e.loadDiscussionFrontend=function(e,t){var n=function(e,t){var n=(0,i.integerCommas)(t);n&&c.default.write(function(){e.textContent=n})},o=function(t){t.on("error",function(e,t){(0,f.default)(t,{feature:"discussion-"+e},!1)}),t.once("comment-count",function(t){if(0===t)e.setState("empty");else{var o=document.getElementsByClassName("js_commentcount_actualvalue");[].concat((0,d.default)(o)).forEach(function(e){n(e,t)})}m.default.emit("comments-count-loaded")})},a=function(e){(0,f.default)(e,{feature:"discussion"})},r=function(e){e(t).then(o).catch(a)};return(0,s.loadScript)(l.default.get("page.discussionFrontendUrl")).then(function(){r(window.guardian.app.discussion)}).catch(a)}}.apply(t,o))&&(e.exports=i)},413:function(e,t,n){var o,i;o=[t,n(0),n(72),n(73),n(76),n(363)],void 0!==(i=function(e,t,n,o,i,s){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.closeTooltip=e.handle=void 0;var r=a(t),u=a(n),d=a(o),l=function(e,t){for(var n=0,o=e.length;n<o;n+=1){var s=e[n].getAttribute("href");if(s){var a=s.split("?")[0],r=(0,i.getUrlVars)(s.split("?")[1]||"&");e[n].setAttribute("href",a+"?"+(0,i.constructQuery)(Object.assign({},r,{returnUrl:t})))}}},c=function(e){var t=document.querySelector(".js-rec-tooltip");if(!t)return Promise.resolve();var n=t.querySelectorAll(".js-rec-tooltip-link");return u.default.write(function(){l(n,e.getAttribute("data-comment-url")),t.removeAttribute("hidden"),e.appendChild(t)})},m=function(e){return!!e&&!!e.querySelector(".d-discussion--recommendations-open")},f=function(e){return u.default.write(function(){e.classList.remove("js-recommend-comment"),e.classList.add("d-comment__recommend--clicked")})},h=function(e){return u.default.write(function(){e.classList.add("js-recommend-comment"),e.classList.remove("d-comment__recommend--clicked")})},p=function(e){return u.default.write(function(){e.classList.add("d-comment__recommend--recommended")})};e.handle=function(e,t,n){if(!r.default.switches.discussionAllowAnonymousRecommendsSwitch&&!n)return e.setAttribute("data-link-name","Recommend comment anonymous"),c(e);if((r.default.switches.discussionAllowAnonymousRecommendsSwitch||n)&&m(t)){var o=e.getAttribute("data-comment-id");return o?Promise.all([f(e),(0,s.recommendComment)(o)]).then(function(){return p(e)}).catch(function(t){return h(e).then(function(){(0,d.default)(t,{feature:"comments-recommend"})})}):Promise.resolve()}return Promise.resolve()},e.closeTooltip=function(){return u.default.write(function(){var e=document.querySelector(".js-rec-tooltip");e&&e.setAttribute("hidden","")})}}.apply(t,o))&&(e.exports=i)},414:function(e,t,n){var o,i;o=[t,n(11),n(13),n(74),n(75),n(49),n(0),n(7),n(367),n(33)],void 0!==(i=function(e,t,n,o,i,s,a,r,u,d){"use strict";function l(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.OnwardContent=void 0;var c=l(t),m=l(n),f=l(o),h=l(i),p=l(s),v=l(a),g=l(r),y=function(){return[].concat((0,p.default)(v.default.get("page.nonKeywordTagIds","").split(",")),(0,p.default)(v.default.get("page.blogIds","").split(",")),[v.default.get("page.seriesId")]).shift()},b=function(){return encodeURIComponent(v.default.get("page.shortUrl"))},C=function(e){function t(e){(0,c.default)(this,t);var n=(0,f.default)(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return(0,u.begin)("series-content"),n.endpoint="/series/"+y()+".json?shortUrl="+b(),n.fetch(e,"html"),n}return(0,h.default)(t,e),(0,m.default)(t,[{key:"error",value:function(){(0,u.error)("series-content")}},{key:"ready",value:function(){(0,u.end)("series-content"),g.default.emit("modules:onward:loaded")}}]),t}(d.Component);e.OnwardContent=C}.apply(t,o))&&(e.exports=i)},449:function(e,t,n){var o,i;o=[e,t,n(41),n(0),n(7),n(72),n(406),n(362),n(392)],void 0!==(i=function(e,t,n,o,i,s,a,r,u){"use strict";function d(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var l=d(n),c=d(o),m=d(i),f=d(s),h=d(u);t.default=function(){var e=(0,l.default)(".js-discussion__ad-slot");if(!r.commercialFeatures.commentAdverts||!e.length)return!1;m.default.once("modules:comments:renderComments:rendered",function(){var t=(0,l.default)(".js-comments .content__main-column");f.default.read(function(){return t.dim().height}).then(function(n){if(!(n<280)){var o=(0,h.default)("comments",{classes:"mpu-banner-ad"});f.default.write(function(){return t.addClass("discussion__ad-wrapper"),c.default.page.isLiveBlog||c.default.page.isMinuteArticle||t.addClass("discussion__ad-wrapper-wider"),e.append(o),o}).then(function(e){return(0,a.addSlot)(e,!1)})}})})},e.exports=t.default}.apply(t,o))&&(e.exports=i)},450:function(e,t,n){var o,i;o=[t,n(11),n(13),n(74),n(75),n(34),n(0),n(33),n(7)],void 0!==(i=function(e,t,n,o,i,s,a,r,u){"use strict";function d(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.MostPopular=void 0;var l=d(t),c=d(n),m=d(o),f=d(i),h=d(s),p=d(a),v=d(u),g=function(e){function t(){(0,l.default)(this,t);var e=(0,m.default)(this,(t.__proto__||Object.getPrototypeOf(t)).call(this)),n=p.default.get("page.section"),o=n&&!["info","global"].includes(n);return e.endpoint="/most-read"+(o?"/"+n:"")+".json",v.default.emit("register:begin","popular-in-section"),e.fetch((0,h.default)(".js-popular-trails"),"html"),e}return(0,f.default)(t,e),(0,c.default)(t,[{key:"ready",value:function(){v.default.emit("modules:popular:loaded"),v.default.emit("register:end","popular-in-section")}}]),t}(r.Component);e.MostPopular=g}.apply(t,o))&&(e.exports=i)},451:function(e,t,n){var o,i;o=[t,n(49),n(0),n(7),n(23),n(72),n(367),n(452)],void 0!==(i=function(e,t,n,o,i,s,a,r){"use strict";function u(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.related=void 0;var d=u(t),l=u(n),c=u(o),m=u(i),f=u(s),h=function(e){new r.Expandable({dom:e,expanded:!1,showCount:!1}).init()},p=function(){if(!l.default.get("page.keywordIds"))return!1;var e=l.default.get("page.keywordIds","").split(","),t=l.default.get("page.isPaidContent")?e:function(e,t){return[].concat((0,d.default)(new Set(e))).filter(function(e){return new Set(t).has(e)})}(["sport/cricket","sport/rugby-union","sport/rugbyleague","sport/formulaone","sport/tennis","sport/cycling","sport/motorsports","sport/golf","sport/horse-racing","sport/boxing","sport/us-sport","sport/australia-sport","football/championsleague","football/premierleague","football/championship","football/europeanfootball","football/world-cup-2014","football/manchester-united","football/chelsea","football/arsenal","football/manchestercity","football/tottenham-hotspur","football/liverpool"],e);return t.length?"/popular-in-tag/"+t[0]+".json":void 0};e.related=function(e){var t=void 0,n=void 0,o=void 0;if(l.default.get("page.hasStoryPackage")){var i=document.body&&document.body.querySelector(".related-trails");i&&h(i)}else if(l.default.get("switches.relatedContent")&&l.default.get("page.showRelatedContent")){var s=document.body&&document.body.querySelector(".js-related");if(s&&!s.classList.contains("lazyloaded")){n=p(),o=n?"related-popular-in-tag":"related-content",(0,a.begin)(o),s.setAttribute("data-component",o),t=n||"/related/"+l.default.get("page.pageId")+".json";var r=e.excludeTags.map(function(e){return"exclude-tag="+e});e.excludeTags&&e.excludeTags.length&&(t+="?"+r.join("&")),(0,m.default)(t,{mode:"cors"}).then(function(e){return f.default.write(function(){s.innerHTML=e.html,s.classList.add("lazyloaded")})}).then(function(){var e=s.querySelector(".related-content");e&&h(e),c.default.emit("modules:related:loaded",s),(0,a.end)(o)}).catch(function(){s.remove(),(0,a.error)(o)})}}else[].concat((0,d.default)(document.querySelectorAll(".js-related"))).forEach(function(e){return e.classList.add("u-h")})}}.apply(t,o))&&(e.exports=i)},452:function(e,t,n){var o,i;o=[t,n(11),n(13)],void 0!==(i=function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.Expandable=void 0;var i=o(t),s=o(n),a=function(){function e(t){(0,i.default)(this,e),this.opts=t,this.dom=t.dom,this.expanded=!1!==t.expanded,this.cta=document.createElement("button"),this.showCount=!1!==t.showCount}return(0,s.default)(e,[{key:"renderState",value:function(){this.expanded?this.dom.classList.remove("shut"):this.dom.classList.add("shut")}},{key:"getCount",value:function(){return parseInt(this.dom.getAttribute("data-count")||"0",10)}},{key:"updateCallToAction",value:function(){var e="Show "+(this.showCount?this.getCount()+" ":"")+(this.expanded?"fewer":"more");this.cta.innerHTML=e,this.cta.setAttribute("data-link-name","Show "+(this.expanded?"more":"fewer")),this.cta.setAttribute("data-is-ajax","1")}},{key:"toggleExpanded",value:function(){this.expanded=!this.expanded,this.renderState(),this.updateCallToAction()}},{key:"isOpen",value:function(){return!this.dom.classList.contains("shut")}},{key:"renderCallToAction",value:function(){var e=this;this.cta.addEventListener("click",function(){e.toggleExpanded()}),this.cta.className="cta",this.opts.buttonAfterEl?this.opts.buttonAfterEl.insertAdjacentElement("afterend",this.cta):this.dom.appendChild(this.cta),this.updateCallToAction()}},{key:"scrollToCallToAction",value:function(){var e=this;this.expanded||window.setTimeout(function(){e.cta.scrollIntoView()},550)}},{key:"init",value:function(){this.dom.classList.contains("expandable-initialised")||!this.dom.innerHTML||this.getCount()<3||(this.dom.classList.add("expandable-initialised"),this.renderCallToAction(),this.renderState())}},{key:"toggle",value:function(){this.toggleExpanded()}}]),e}();e.Expandable=a}.apply(t,o))&&(e.exports=i)},453:function(e,t,n){var o,i;o=[t,n(11),n(74),n(13),n(75),n(0),n(7),n(367),n(33)],void 0!==(i=function(e,t,n,o,i,s,a,r,u){"use strict";function d(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.TonalComponent=void 0;var l=d(t),c=d(n),m=d(o),f=d(i),h=d(s),p=d(a),v={uk:{features:"uk-alpha/features/feature-stories",comment:"uk-alpha/contributors/feature-stories"},us:{features:"us-alpha/features/feature-stories",comment:"us-alpha/contributors/feature-stories"},au:{features:"au-alpha/features/feature-stories",comment:"au-alpha/contributors/feature-stories"},int:{features:"22167321-f8cf-4f4a-b646-165e5b1e9a30",comment:"ee3386bb-9430-4a6d-8bca-b99d65790f3b"}},g=function(e){function t(){(0,l.default)(this,t);var e=(0,c.default)(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return(0,r.begin)("tonal-content"),e.edition=h.default.get("page.edition","").toLowerCase(),e.isSupported()&&(e.endpoint=e.getEndpoint()),e}return(0,f.default)(t,e),(0,m.default)(t,null,[{key:"getTone",value:function(){return h.default.get("page.tones","").split(",")[0].toLowerCase()}},{key:"ready",value:function(){p.default.emit("modules:tonal:loaded"),(0,r.end)("tonal-content")}},{key:"error",value:function(){(0,r.error)("tonal-content")}}]),(0,m.default)(t,[{key:"getEndpoint",value:function(){return"/container/"+v[this.edition][t.getTone()]+".json"}},{key:"isSupported",value:function(){return t.getTone()in v[this.edition]}}]),t}(u.Component);e.TonalComponent=g}.apply(t,o))&&(e.exports=i)},454:function(e,t,n){var o,i;o=[t,n(28),n(73),n(41),n(23),n(0),n(395),n(107),n(197),n(455),n(456)],void 0!==(i=function(e,t,n,o,i,s,a,r,u,d,l){"use strict";function c(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.loadShareCounts=void 0;var m=c(t),f=c(n),h=c(o),p=c(i),v=c(s),g=c(r),y=c(d),b=c(l),C=(0,h.default)(".js-sharecount"),_={facebook:"n/a"},w=0,k=void 0,T=void 0,E=function(e){if(0!==e){w+=e;var t=parseInt(w.toFixed(0),10),n=(0,a.integerCommas)(t),o=t>1e4?Math.round(t/1e3)+"k":t;m.default.write(function(){k.text(n),T.text(o)})}},S=function(){C.attr("title",(0,g.default)("Facebook: <%=facebook%>",_))},P=function(e){var t=(0,u.inlineSvg)("share"),n=C.hasClass("js-sharecount-immersive")?b.default:y.default,o=(0,g.default)(n,{icon:t});C.removeClass("u-h").html(o).css("display",""),T=(0,h.default)(".sharecount__value--short",C[0]),k=(0,h.default)(".sharecount__value--full",C[0]),E(e)},A=function(){var e=v.default.page.ajaxUrl+"/sharecount/"+v.default.page.pageId+".json";(0,p.default)(e,{mode:"cors"}).then(function(e){var t=e.share_count||0;_.facebook=t,P(t),S()})};e.loadShareCounts=function(){if(v.default.switches.serverShareCounts&&C.length&&!v.default.page.isPreview)try{A()}catch(e){(0,f.default)(new Error("Error retrieving share counts ("+e.message+")"),{feature:"share-count"},!1)}}}.apply(t,o))&&(e.exports=i)},455:function(e,t){e.exports='<h3 class="sharecount__heading"><%=icon%><span class="sharecount__text u-h">Shares</span></h3>\n<div class="sharecount__value sharecount__value--full">0</div>\n<div class="sharecount__value sharecount__value--short">0</div>\n'},456:function(e,t){e.exports='<%= icon %><span class="sharecount__value sharecount__value--short">0</span> Shares\n'},457:function(e,t,n){var o,i;o=[t,n(42),n(0),n(33)],void 0!==(i=function(e,t,n,o){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.onwardVideo=void 0;var s=i(t),a=i(n),r=function(e){return Boolean(a.default.page.seriesTags)?"/video/in-series/"+a.default.page.seriesId+".json":"/"+(a.default.page.isPodcast?"podcast":e)+"/most-viewed.json"},u=function(e,t,n,i){var s=new o.Component;return s.manipulationType=n,s.endpoint=t+(i?"?page="+i:""),e.innerHTML="",s.fetch(e,"html")},d=function(e,t,n){s.default.on(e,"click",".most-viewed-navigation__button",function(o){var i=o.target.getAttribute("data-page");return u(e,n,t,i),o.preventDefault(),!1})};e.onwardVideo=function(e,t){var n="video"===t?"append":"html",o=r(t);u(e,o,n).then(function(){d(e,n,o)})}}.apply(t,o))&&(e.exports=i)},458:function(e,t,n){var o,i;o=[t,n(33),n(7),n(202)],void 0!==(i=function(e,t,n,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.moreInSeriesContainerInit=void 0;var i=function(e){return e&&e.__esModule?e:{default:e}}(n);e.moreInSeriesContainerInit=function(e,n,s,a,r){var u=new t.Component,d="/"+n+"/section/"+s+(r?"/"+r:"")+".json?shortUrl="+a+("video"===n?"&exclude-tag=guardian-professional/guardian-professional":"");u.endpoint=d,u.fetch(e).then(function(){(0,o.checkElemsForVideos)([e]),i.default.emit("page:media:moreinloaded",e)})}}.apply(t,o))&&(e.exports=i)}});
//# sourceMappingURL=graun.trail.js.map